{
  "hash": "bd48bc4e482fb56803659d8d345dc83a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Température de l'eau au cap d'Antibes\"\nauthor: \"Antibes Data\"\ndate: \"2025-01-23\"\ncategories: [open data, antibes]\nimage: \"plots/temperature eau_mois_m.png\"\nabstract: Distribution des revelés de température de l'eau\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Introduction\n\nDistribution des relevés de température de l'eau au cap d'Antibes (Celsius), par mois et par année.\n\n# Résultats\n\nEn été l'ouest du cap est légèrement plus chaud que l'est du cap. \\\nEn hiver l'est du cap semble légèrement moins froid que l'ouest du cap.\\\nLimite: ces différences ne sont pas très significatives.\n\n# Visualisation\n\n![](plots/temperature%20eau_mois_m.png){fig-align=\"center\"}\n\n# Code\n\n## Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggridges)\nlibrary(viridis)\nlibrary(slider)\nlibrary(patchwork)\nlibrary(paletteer)\n\ndate_caption <- \"31 décembre 2024\"\nsource(\"tools/themes.R\") # themes\n\nsource_est <- read_csv(\"posts/2025-01-23/data/antibes-eau-temperature-est-cap.csv\")\nsource_ouest <- read_csv(\"posts/2025-01-23/data/antibes-eau-temperature-ouest-cap.csv\")\n\ndf_est <-source_est\ndf_ouest <- source_ouest\n```\n:::\n\n\n\n## Inspect\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df_est)\nnames(df_est)\nglimpse(df_est)\nsummary(df_ouest)\n```\n:::\n\n\n\n## Clean\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# standardize and bind datasets\nfn_clean <- function(df, name) {\n  # standardize cols\n  df <-\n    df %>% \n    select(-1, -2) %>%                  # remove useless cols\n    rename_with(tolower) %>%                      # lower case variable names\n    rename_with(~ str_squish(.)) %>%             \n    rename_with(~ str_replace_all(.,\"annee \", \"\"))\n  \n  # adding useful cols\n  df <-\n    df %>%\n    mutate(region = name)\n  \n  # pivot longer\n  df<-\n    df %>%\n    pivot_longer(cols = 2:6, names_to = \"annee\", values_to = \"temperature\")\n  \n  return(df)\n}\n\ndf_ouest_clean <- fn_clean(df_ouest, \"ouest\")\ndf_est_clean <- fn_clean(df_est, \"est\")\n\n# bind\ndf_bind <- bind_rows(df_est_clean, df_ouest_clean)\n\n# Manage dates\ndf_bind_clean <-\n  df_bind %>% \n    separate(jour, c(\"day\", \"month\"), \"-\") %>%\n    mutate(month = str_replace_all(month, \"\\\\.\", \"\"),\n           month = str_to_title(month)) # Need to escape the dot (.) here\n  \n# check  \nunique(df_bind_clean$month) # month col still needs cleaning \n\ndf_bind_clean <-\n  df_bind_clean %>%\n    mutate(month = recode(month,\n                          \"Janv\" = \"Jan\",\n                          \"Fevr\" = \"Feb\",\n                          \"Febr\" = \"Feb\",\n                          \"Févr\" = \"Feb\",\n                          \"Mars\" = \"Mar\", \n                          \"Avr\" = \"Apr\",\n                          \"Mai\" = \"May\", \n                          \"Juin\" = \"Jun\",\n                          \"Juil\" = \"Jul\",\n                          \"Août\" = \"Aug\",\n                          \"Sept\" = \"Sep\",\n                          \"Oct\" = \"Oct\",\n                          \"Déc\" = \"Dec\"\n            ))            \n \n# add date col \ndf_bind_clean <-\n  df_bind_clean %>% \n    mutate(date = dmy(paste(day, month, annee, sep = \"-\"))) %>%\n    select(region, date, temperature, year = annee, month, day) %>% # reorder\n    drop_na() %>%                                                   # drop NA\n    arrange(date)\n```\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Line graph \nplot_region_year <-\ndf_bind_clean %>%\n  drop_na() %>%\n  mutate(date = update(date, year = 2024)) %>% # plot on synchronous x-axis, /!\\ chose a leap year\n  ggplot(aes(x = date, y = temperature, group = year)) + \n  geom_line(aes(color = region)) +\n  scale_x_date(date_breaks = \"4 month\", date_labels = \"%b\") +\n  facet_wrap(~region+year, nrow = 2) \n plot_region_year\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n     df_bind_clean_plot <-\n     df_bind_clean %>%\n       filter(year > 2020) %>%\n       mutate(region = recode(region, \"est\" = \"Est du Cap\",\n                                      \"ouest\" = \"Ouest du Cap\")) %>%\n       mutate(month = factor(month, \n                             levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")))\n     \n     \n    # Ridges temperatures per year\n    plot_ridges_year <-\n      df_bind_clean_plot %>%\n      group_by(year) %>%\n      ggplot(aes(x = temperature, y = year, fill = after_stat(x))) +\n      geom_density_ridges_gradient(color = darkblue) +  \n      scale_fill_gradientn(colors = custom_palette_water_temp) +\n      coord_cartesian(xlim=c(5,34)) +\n      scale_x_continuous(labels = scales::label_dollar(prefix = \"\", suffix = \"°c\"))  \n    plot_ridges_year\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\n    # Ridges for temperature by month\n    plot_ridges_month <-\n      df_bind_clean_plot %>%\n      group_by(month) %>%\n      ggplot(aes(x = temperature, y = fct_rev(month), fill = after_stat(x))) +\n      geom_density_ridges_gradient(color = darkblue) +  \n      scale_fill_gradientn(colors = custom_palette_water_temp) +\n      coord_cartesian(xlim=c(9,31)) +\n      scale_x_continuous(labels = scales::label_dollar(prefix = \"\", suffix = \"°c\"))\n    plot_ridges_month\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n\n## Render\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ridges_year_final <-  \nplot_ridges_year + \n    facet_wrap(~region, ncol =1, strip.position = \"top\", scales = \"free\") +\n   labs(\n     title = \"Baignade : l'année 2024 légèrement plus chaude que les précédentes\",\n     subtitle = \"Distribution des revelés de température de l'eau au cap d'Antibes (Celsius), par années\",\n     x = \"Température (Celsius)\",\n     caption = social_caption2) + tt8\n  \nplot_ridges_month_final <-    \nplot_ridges_month + \n  facet_wrap(~region, ncol =1, strip.position = \"top\", scales = \"free\") +\n  labs(\n    title = \"Antibes Juan-Les-Pins baignable une grande partie de l'année\",\n    subtitle = \"Distribution des revelés de température de l'eau au cap d'Antibes (Celsius), par mois\",\n    x = \"Température (Celsius)\",\n    caption = social_caption2) + tt8\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ridges_month_final  \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ridges_year_final\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\n::: {.callout-note collapse=\"true\"}\n```         \nSmoothing with a moving average method using slide_dbl() will not plot correctly because there are irregular missing dates in the data. \nFixing this would require filling missing values with tidyr::complete() and then filling upwards the NA values or computing them, or using library(zoo) for something like rollmean(df_bind_clean$temperature, 3, fill = \"extend\"). \nWe are chosing to work with actual values only for this analysis.\n```\n:::\n\n# Source\n\n[Température de l’eau de mer à Antibes Juan-les-Pins, disponible sur data.gouv.fr](https://www.data.gouv.fr/fr/datasets/temperature-de-leau-de-mer-a-antibes-juan-les-pins/). Mise à jour du 31 décembre 2024.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}