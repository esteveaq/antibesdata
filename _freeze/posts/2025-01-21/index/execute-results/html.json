{
  "hash": "d24b05f37219a9cc88a0a923d244ddd8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activités sportives à Antibes\"\nauthor: \"Antibes Data\"\ndate: \"2025-01-21\"\ncategories: [open data, antibes]\nimage: \"plots/animations_sportives_total.png\"\nabstract: Evolution, lieux et organisateurs des activités sportives à Antibes Juan-Les-Pins\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Introduction\n\nAnalyse du nombre d'activités sportives répertoriées à Antibes Juan-les-Pins entre 2023 et 2020.\n\n# Résultats\n\nL'année 2022 a été particulièrement active en terme d'activités sportives.\\\nL'organisateur le plus actif est la **Direction des sports de la ville d'Antibes**.\\\nLe lieux le plus actif est le **Clos Borriglion**.\n\n# Visualisation\n\n![](plots/animations_sportives_total.png){fig-align=\"center\"}\n\n![](plots/orgs_lieux.png)\n\n# Code\n\n## Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(skimr)\nlibrary(plotly)\nlibrary(gghighlight)\nlibrary(patchwork)\n\ndate_caption <- \"9 janvier 2024\"\nsource(\"tools/themes.R\") # themes\n\nsource <- read_csv(\"posts/2025-01-21/data/antibes-animations-sportives.csv\")\ndf <- source\n```\n:::\n\n\n\n## Inspect\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\nunique(df$ORGANISATEUR)\ncolnames(df)\nglimpse(df)\nmax(df$`DATE FIN`)\n```\n:::\n\n\n\n## Clean\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n # standardize cols names and variables in chr type\ndf <-\n  df %>% \n    rename_with(tolower) %>%\n    rename_with(~ str_squish(.)) %>%\n    rename_with(~ str_replace_all(., \" \", \"_\")) %>%\n    mutate(across(where(is.character), ~ str_squish(str_to_lower(.)))) %>%\n    mutate(across(c(date_debut, date_fin), as.Date))\n\n# drop NA\ndf <-\n  df %>% \n  drop_na(date_debut, date_fin, organisateur) \n# check no NAs are remaining  \nskim(df) \n\n# remove unwanted cols\ndf <-\n  df %>%      \n    select(animations, date_debut, date_fin, organisateur, lieu_1)\n\n# adding useful cols\ndf <-\n df %>% mutate(yd = year(date_debut),\n         md = month(date_debut),\n         dd = day(date_debut),\n         yf = year(date_fin),\n         mf = month(date_fin),\n         df = day(date_fin),\n         yearmonth = paste0(yd,\"-\", md)\n         ) %>% arrange(yd, md, dd) %>%\n  mutate(duration = (date_fin - date_debut)\n)\n```\n:::\n\n\n\n## Further cleaning using OpenRefine\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save file for OpenRefine\nwrite_csv(df, \"posts/2025-01-21/data/animations.csv\")\n\n# load refined data\ndf_refined <- read_csv(\"posts/2025-01-21/data/animations_openrefined.csv\")\n\n# additional cleaning step \ndf_refined <- \n  df_refined %>%\n  mutate(organisateur = case_when(\n    organisateur %in% c(\"asf boules\", \"as fontonne boule\") ~ \"as fontonne boules\",\n    TRUE ~ organisateur\n  ))\n\n# filter year\ndf_refined <- \n  df_refined %>% filter(yd > 2019) \n\n# title case variables \ndf_refined <-\n  df_refined %>%\n  mutate(across(c(lieu_1, organisateur), str_to_title))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_refined\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 603 × 13\n   animations  date_debut date_fin   organisateur lieu_1    yd    md    dd    yf\n   <chr>       <date>     <date>     <chr>        <chr>  <dbl> <dbl> <dbl> <dbl>\n 1 bain du jo… 2020-01-01 2020-01-01 Day One      Plage…  2020     1     1  2020\n 2 rencontre … 2020-01-04 2020-01-04 Badminton C… Gymna…  2020     1     4  2020\n 3 match pare… 2020-01-12 2020-01-12 Oajlp Handb… Salle…  2020     1    12  2020\n 4 ag wild mo… 2020-01-12 2020-01-12 Wild Move    Base …  2020     1    12  2020\n 5 ski voile … 2020-01-16 2020-01-19 Société Des… Port …  2020     1    16  2020\n 6 19ème souv… 2020-01-19 2020-01-19 Antibes Vél… Parki…  2020     1    19  2020\n 7 rencontre … 2020-01-21 2020-01-24 Asf Hockey … Stade…  2020     1    21  2020\n 8 challenge … 2020-01-22 2020-01-22 Handisport … Salle…  2020     1    22  2020\n 9 sélection … 2020-02-01 2020-02-01 Oajlp Gymna… Salle…  2020     2     1  2020\n10 top 12 gym  2020-02-08 2020-02-08 Oajlp Gymna… Foch    2020     2     8  2020\n# ℹ 593 more rows\n# ℹ 4 more variables: mf <dbl>, df <dbl>, yearmonth <chr>, duration <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Analysis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# faceting : top organizers, locations, activities\norgs <-\n  df_refined %>% \n  count(organisateur) %>% arrange(-n)\norgs\n\nlieux <-\n  df_refined %>% \n  count(lieu_1) %>% arrange(-n)\nlieux\n\nactivities <-\n  df_refined %>% \n  count(animations) %>% arrange(-n)\nactivities\n\n# Filter top 10 organisateurs\ntop_orgs <- orgs %>% \n  slice_max(order_by = n, n = 10)\n\n# Filter top 10 lieux\ntop_lieux <- lieux %>% \n  slice_max(order_by = n, n = 10)\n\n# Count\ncount.animations.year <-\ndf_refined %>%\ncount(yd)  \n\ncount.animations.yearmonth <-\ndf_refined %>%\n  count(yearmonth)\n\n# Averages\nmean(df_refined$duration) # mean duration\nskim(df_refined$duration) # other stats\n```\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Color \n  c_highlight <-\"#1D6FA1\"\n  \n## Col chart per month  \ndf_plot.year.facet <-\n  df_refined %>%\n  group_by(yd, md, organisateur) %>%\n  count() %>%\n  mutate(yd = factor(yd, levels = c(\"2023\", \"2022\", \"2021\", \"2020\")))  \n\nplot.year.facet <-\n  df_plot.year.facet %>%\n  ggplot(aes(x = md, y = n)) +\n  geom_col(fill = c_highlight, alpha = 0.6) +\n  geom_col(data = df_plot.year.facet %>% filter(yd == 2023), fill = c_highlight, alpha = 1) +\n  geom_text( # axis labels\n    data = data.frame(x = 12.9, y = seq(0, 40, by = 10)),\n    aes(x, y, label = y),\n    color = \"black\",\n    family = setfont,\n    hjust = 1, \n    vjust = -0.5, \n    size = 3.5\n  ) +\n  geom_text(data = count.animations.year %>% filter(yd == 2023),\n            aes(x = 2, y = 34, label = paste0(n, \" activités en 2023\")),\n            family = setfont,\n            hjust = 0.3,\n            fontface = \"bold\",\n            color = c_highlight,\n            size = 6) +\n  geom_text(data = count.animations.year %>% filter(yd < 2023),\n            aes(x = 2, y = 34, label = paste0(n, \" activités\")),\n            family = setfont,\n            color = c_highlight,\n            hjust = 0.5,\n            alpha = 0.6,\n            size = 6) +\n  scale_x_continuous( limits = c(0, 13),\n                      expand = c(0, 0), \n                      breaks = seq(1, 12, by = 1),\n                      labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"),\n                     ) +\n  scale_y_continuous(expand = c(0, 0)) + #start axis origin at 0\n  facet_wrap(~yd, ncol = 1, strip.position = \"left\", scales = 'free_x') + \n  theme(legend.position = \"none\") \n\np <- \nplot.year.facet +\n  labs(title = \"Moins d'activités sportives à Antibes en 2023 par rapport à 2022\",\n       subtitle = \"Nombre d'activités sportives organisées à Antibes par mois et par années.\",\n       caption = social_caption2) + tt2\n                        \n  # Bar charts for top 10s  \n\n    # Plot for top 10 organisateurs\n    plot_orgs <- ggplot(top_orgs, aes(x = reorder(organisateur, n), y = n)) +\n      geom_bar(stat = \"identity\", fill =  \"#457ECD\") +\n      geom_text(aes(label = n), hjust = 1.8, size = 8, family = setfont, fontface = \"bold\", color = \"white\") +\n      coord_flip() +\n      labs(\n        title = \"Top 10 des organisateurs d'activités sportives à Antibes\",\n        subtitle = \"Classement des organisations sportives d'Antibes Juan-Les-Pins, par nombre d'activités organisées. Période 2020-2023\",\n        caption = social_caption2\n      ) + tt4\n    \n    # Plot for top 10 lieux\n    plot_lieux <- ggplot(top_lieux, aes(x = reorder(lieu_1, n), y = n)) +\n      geom_bar(stat = \"identity\", fill = \"#FC972F\") +\n      geom_text(aes(label = n), hjust = 1.8, size = 8, family = setfont, fontface = \"bold\", color = darkblue) +\n      coord_flip() +\n      labs(\n        title = \"Top 10 des lieux d'activités sportives à Antibes\",\n        subtitle = \"Classement des lieux d'Antibes Juan-Les-Pins, par nombre d'activités sportives acceuillies. <br>Période 2020-2023\",\n        caption = social_caption2\n        \n      ) + tt4\n```\n:::\n\n\n\n# Render\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n    plot_orgs \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n\n```{.r .cell-code}\n    plot_lieux        \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-2.png){width=960}\n:::\n\n```{.r .cell-code}\n    p\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-3.png){width=960}\n:::\n:::\n\n\n\n# Source\n\n[Manifestations sportives à Antibes Juan-les-Pins, disponible sur data.gouv.fr](https://www.data.gouv.fr/fr/datasets/manifestations-sportives-a-antibes-juan-les-pins/). Mise à jour du 9 janvier 2024.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}