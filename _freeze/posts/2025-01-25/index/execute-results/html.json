{
  "hash": "5f3c36d160b7fa400a0ac57f2a37f5cf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Fréquentation des musées d'Antibes\"\n# author: \"Antibes Data\"\ndate: \"2025-01-25\"\ncategories: [open data, antibes]\nimage: \"plots/musees.gif\"\nabstract: Hausse record des visiteurs post-COVID\n---\n\n\n\n# Introduction\n\nCe poste analyse le nombre de visiteurs dans les musées d'Antibes depuis 2008. Une animation est réalisée pour illustrer la baisse durant le COVID puis la reprise à des niveaux records. Les musées concernés sont le **Musée Picasso** et le **Musée de l'Archéologie**. Le nombre de visiteurs est agrégé sur ces deux musées.\n\n# Résultats\n\nLa fréquentation des musées atteints des niveaux records suite à la période du COVID-19.\n\n# Visualisation\n\n![](plots/musees.gif){fig-align=\"center\"}\n\n# Code\n\n## Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(showtext)\nlibrary(gganimate)\nlibrary(gifski)\n\ndate_caption <- \"13 janvier 2025\"\nsource(\"tools/themes.R\")\n\nmusee_frequentation <- read_csv(\"posts/2025-01-25/data/antibes-frequentation-musees-france.csv\")\n```\n:::\n\n\n\n## Analysis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data to draw line geom \ndataplot <-\nmusee_frequentation %>%\n  filter(ANNEE>2007) %>%\n  group_by(ANNEE) %>%\n  summarize(tot = sum(NB_TOTAL_ENTREES))\ndataplot\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 17 × 2\n   ANNEE    tot\n   <dbl>  <dbl>\n 1  2008 110068\n 2  2009 140005\n 3  2010 138800\n 4  2011 135151\n 5  2012 132157\n 6  2013 137711\n 7  2014 167305\n 8  2015 150944\n 9  2016 131244\n10  2017 134775\n11  2018 124964\n12  2019 142284\n13  2020  47237\n14  2021  78463\n15  2022 160544\n16  2023 201000\n17  2024 197190\n```\n\n\n:::\n\n```{.r .cell-code}\n# data to draw dot symbolizing the max value at the end of the line\ndataplot_max <-\n  dataplot %>%\n  filter(ANNEE == max(ANNEE))\ndataplot_max\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  ANNEE    tot\n  <dbl>  <dbl>\n1  2024 197190\n```\n\n\n:::\n\n```{.r .cell-code}\n#highlight color for plot\nhighlight <- \"#0E2C48\"\nhighlighttext <- \"#4B9E8C\"\nhighlightmain <- \"#824B79\"\n```\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Static Plot for testing\nplot_musee_frequentation <-\n  dataplot %>% \n  ggplot(aes(x = ANNEE, y = tot/1000, group = 1)) + #divided to obtain thousands\n  geom_line(size = 1.5, color = \"#0E2C48\") +\n  geom_point(data = dataplot_max, size = 4, color = highlight) +\n  scale_x_continuous(breaks = c(2014,2020,2023, 2024), \n                     expand = c(0.1, 0.1),\n                     ) \nplot_musee_frequentation\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Animated Plot\n# Create a new col to control the speed of the animation\ndataplot_slowdown <- \n  dataplot %>%\n  mutate(\n    show_time = case_when(      # Adjust show_time for specific years\n      ANNEE %in% c(2020) ~ 10,  # Show these years longer\n      TRUE ~ 1),  # Default speed for others\n    reveal_time = cumsum(show_time)  # Cumulative time for each point\n  )\n\n# Get thousands instead of individual visitors\ndataplot_slowdown$tot <- round(dataplot_slowdown$tot/1000, 0)\n\n\n# Final Plot\nplot_musee_anim <-\n  dataplot_slowdown %>% \n  ggplot(aes(x = ANNEE, y = tot, group = 1)) + \n  geom_line(size = 2, color = highlightmain) +\n  geom_point(size = 4, color = highlightmain) + \n  geom_text(aes(label = paste(tot)), \n                vjust = 0, hjust = -0.3, color =  \"#3D2358\",\n                fontface = \"bold\",\n                family = setfont,\n                size = 6, show.legend = FALSE) +\n  geom_text(aes(\n            x = 2016,\n            y = max(dataplot_slowdown$tot) - 26,\n            label = paste(ANNEE)), \n            vjust = -0.05, \n            hjust = 0.15, \n            color = \"#946285\",\n          #  fontface = \"bold\",\n            size = 25, show.legend = FALSE) +\n  labs(y = \"Total des visiteurs\",\n       x = \"Années\",\n       title = \"Musées d'Antibes: visiteurs en hausse post-covid\",\n       subtitle = \"En milliers de visiteurs dans les musées de France\",\n       caption = social_caption2) +\n  scale_x_continuous(expand = c(0, 1.3),\n                     breaks = c(2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022, 2024)) +\n  scale_y_continuous(expand = c(0.1, 0.1),\n                    labels = scales::label_number(suffix = \" K\")) +\n  tt\n```\n:::\n\n\n\n## Render\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# render\nanimp <-\n  plot_musee_anim +\n  transition_reveal(reveal_time) +\n  ease_aes()\n\n# render with timing \n a <-  \n   animate(animp,\n           start_pause= 5,\n           end_pause = 100,\n           fps = 25,\n           duration = 10,\n           width = 1000,\n           height = 1200,\n           res = 150        # Set resolution (DPI)\n           )\n\nanim_save(\"posts/2025-01-25/plots/musees.gif\", a)\n```\n:::\n\n\n\n![](plots/musees.gif)\n\n# Source\n\n[Fréquentation des Musées de France de la Ville d'Antibes, disponible sur data.gouv.fr](https://www.data.gouv.fr/fr/datasets/frequentation-des-musees-de-france-de-la-ville-dantibes/). Mise à jour du 13 janvier 2025\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}