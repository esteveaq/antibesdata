{
  "hash": "811a8e62e7a58f45659b7e01a52c453d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mandats des maires d'Antibes du XIXème siècle à nos jours\"\nauthor: \"Antibes Data\"\ndate: \"2025-01-20\"\ncategories: [open data, antibes]\nimage: \"plots/2025-01-09_maires_m.png\"\nabstract: Durée des mandats des maires d'Antibes du XIXème siècle à nos jours\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Introduction\n\nVisualisation des données publiées sur data.gouv.fr par la ville d'Antibes Juan-Les-Pins \"Maires d'Antibes depuis 1681 jusqu'aux élections de mars 2020 incluses.\"\n\n# Résultats\n\nAprès Jean Baptiste-ROSTAN (1831-1865), le maire d'Antibes avec la plus grande longévité est Jean LEONETTI (1995-2026).\n\n# Visualisation\n\n![](plots/2025-01-09_maires_m.png){fig-align=\"center\"}\n\n# Code\n\n## Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(skimr)\n\ndate_caption <- \"9 juin 2020\"\nsource(\"tools/themes.R\") # themes\n# Idea : https://jrnold.github.io/priestley/articles/priestley.html\n\nsource <- read_csv2(\"posts/2025-01-20/data/antibes-maires-depuis1681.csv\")\ndf <- source\n```\n:::\n\n\n\n## Inspect\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\ntail(df)\nglimpse(df)\nskim(df)\nsummary(df)\nstr(df)\nnames(df)\ncolnames(df)\nunique(df$MAIRE_NOM)\njanitor:::tabyl(df$MAIRE_NOM)  %>% arrange(-percent)\n```\n:::\n\n\n\n## Clean\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- \n  df %>%\n  select(3:9) %>%\n  select(-6) %>%\n  mutate_if(is.character, as.factor) %>%\n  mutate(duree = df$FIN_MANDAT-df$DEBUT_MANDAT_ANNEE) %>%\n  ungroup() %>%\n  arrange(MAIRE_NOM) %>%\n  arrange(DEBUT_MANDAT_ANNEE) %>%\n  group_by(MAIRE_NOM, MAIRE_PRENOM) %>%\n  mutate(id = cur_group_id()) %>% # group ids\n  mutate(dureetot = cumsum(duree)) %>%\n  mutate(dureetotmax = max(dureetot)) %>%\n  unite(idnom, c(MAIRE_PRENOM,MAIRE_NOM,id), remove = FALSE) \n\ndf <-\n  df %>% \n  mutate(CONTEXTE_HISTORIQUE = str_to_title(CONTEXTE_HISTORIQUE))\n\n#make col with unique names\ndf <- df %>%\n  mutate(labelname = paste0(`MAIRE_PRENOM`, \" \", `MAIRE_NOM`)) %>%\n  group_by(labelname) %>%\n  mutate(labelname = ifelse(row_number() == 1, labelname, NA_character_)) %>%\n  ungroup()\n\n  #check labelname are unique\nprint(df[c(\"idnom\", \"labelname\")])\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 110\nColumns: 12\n$ idnom               <chr> \"Honoré_BERNARDY_8\", \"Antoine_REGNARD_49\", \"Honoré…\n$ MAIRE_PRENOM        <fct> Honoré, Antoine, Honoré, non communiqué, Honoré, J…\n$ MAIRE_NOM           <fct> BERNARDY, REGNARD, LEON, GUIRAUD, CARENCE, ARAZY, …\n$ DEBUT_MANDAT_ANNEE  <dbl> 1681, 1701, 1702, 1704, 1705, 1706, 1711, 1712, 17…\n$ FIN_MANDAT          <dbl> 1681, 1701, 1702, 1704, 1705, 1706, 1711, 1712, 17…\n$ PROFESSION_MAIRE    <fct> \"Avocat à la cour d'Aix\", \"Maître-apothicaire\", \"B…\n$ CONTEXTE_HISTORIQUE <chr> \"Grand Siecle\", \"Grand Siecle\", \"Grand Siecle\", \"G…\n$ duree               <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ id                  <int> 8, 49, 36, 30, 12, 1, 36, 18, 16, 51, 17, 62, 6, 3…\n$ dureetot            <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ dureetotmax         <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ labelname           <chr> \"Honoré BERNARDY\", \"Antoine REGNARD\", \"Honoré LEON…\n```\n\n\n:::\n:::\n\n\n\n## Analyze\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create CONTEXTE HISTORIQUE BOXES\ndf <-\ndf %>% \n  group_by(CONTEXTE_HISTORIQUE) %>%\n  mutate(CONTEXTEmin = min(DEBUT_MANDAT_ANNEE),\n         CONTEXTEmax = max(FIN_MANDAT)) %>%\n  ungroup()\n\n#create CONTEXTE HISTORIQUE bins\ndf<-\n  df %>%\n  mutate(phase = cut(DEBUT_MANDAT_ANNEE,\n                     breaks = c(1680,1800,1900,2020,2026),\n                     labels = c(\"XVII-XVIIIeme\", \"XIXeme\", \"XXeme\", \"XXIeme\"))) %>%\n  filter(DEBUT_MANDAT_ANNEE > 1808)\n```\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntimeline <- \ndf %>%\n  mutate(phase = fct_rev(phase)) %>%  # Reverse the order of facets\n  ggplot(aes(\n    x = DEBUT_MANDAT_ANNEE, \n    y = reorder(idnom, DEBUT_MANDAT_ANNEE), \n    )) +\n  geom_segment(aes(xend = FIN_MANDAT, \n                   yend = idnom,\n                   color = reorder(CONTEXTE_HISTORIQUE, FIN_MANDAT) \n                   ),  \n               linewidth = 6, lineend = \"round\"\n               ) +\n  geom_text(\n              aes(label = labelname),\n              size = 4.5, \n              hjust = 0.05,\n              nudge_y = 0.4, \n              family = setfont,\n              color = \"gray20\"\n  ) +\n  geom_text(data = df %>%\n                    filter(df$dureetotmax >= 9) %>%\n                    group_by(idnom) %>%\n                    summarise(dureetotmax = max(dureetotmax),\n                              DEBUT_MANDAT_ANNEE = min(DEBUT_MANDAT_ANNEE)),\n            aes(\n              x = DEBUT_MANDAT_ANNEE,\n              y = reorder(idnom, DEBUT_MANDAT_ANNEE), \n              label = paste0(dureetotmax, \" ans\")\n              ),\n            size = 4,\n            hjust = 0.1,\n            vjust = 2.1,\n            nudge_y = 0.4,\n            family = setfont,\n            color = \"white\",\n            fontface = \"bold\"\n            ) +\n  annotate(\n    \"label\",\n    x = -Inf,  # Position at the far left of the plot\n    y = Inf,   # Position at the top of the plot\n    label = \"  \n    \n  Jean LEONETTI est maire d'Antibes depuis 1995, \n  et totalisera 31 années de mandats d'ici 2026.\n  Il est aussi député des Alpes-Maritimes et\n  président de la communauté d'agglomération \n  de Sophia Antipolis depuis 2002.\n  L'élu détient le record de longévité après \n  Jean-Baptiste ROSTAN, qui a servi 34 ans \n  entre 1831 et 1865.\",\n    hjust = 0,  \n    vjust = 1, \n    family = setfont,\n    fontface = \"bold\",\n    size = 4.5, \n    color = \"gray30\",  \n    fill = \"#FAE5C6\",\n    label.size = 0   # Removes the border around the label\n  ) +\n  annotate(\n    \"curve\",\n    x = 1928,   \n    xend = 1990,     \n    y = max(as.numeric(factor(df$idnom)))-0.5,  \n    yend = max(as.numeric(factor(df$idnom))+0.1),    \n    curvature = -0.2,              \n    arrow = arrow(length = unit(0.02, \"npc\"), type = \"open\"),\n    colour = \"gray30\",            \n    size = 1.2                   \n  ) +\n  labs(title = \"Jean Leonetti : record de longévité à la mairie d'Antibes\",\n       subtitle = \"Mandats des maires d'Antibes du XIXème siècle à nos jours\",\n       caption = social_caption2,\n       color =\"Contexte historique\") +\n  scale_color_manual(values = custom_palette) +\n  scale_fill_manual(values = custom_palette) +\n  tt.maires +\n  guides(color = guide_legend(reverse = TRUE)) +\n  scale_x_continuous(\n    limits = c(min(df$DEBUT_MANDAT_ANNEE)-1, max(df$FIN_MANDAT) + 1), # Add space\n    expand = expansion(mult = 0.1)                      # Add 10% space on both sides\n  )\n```\n:::\n\n\n\nRender\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntimeline\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=2250}\n:::\n:::\n\n\n\n# Source\n\n[Maires de la Ville d'Antibes, disponible sur data.gouv.fr](https://www.data.gouv.fr/fr/datasets/maires-de-la-ville-dantibes/). Mise à jour du 9 juin 2020\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}