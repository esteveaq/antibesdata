{
  "hash": "84860e38271da818680b26023fe5e19c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Naissances et prénoms à Antibes\"\nauthor: \"Antibes Data\"\ndate: \"2025-01-22\"\ncategories: [open data, antibes]\nimage: \"plots/prenoms_m2.png\"\nabstract: Prénoms des nouveaux-nés déclarés à l’état-civil à Antibes.\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Introduction\n\nCe poste propose une analyse statistique des naissances à Antibes sur la période 2013-2023. Un graphe en barres décrit le volume des naissances, et les segments décrivent la croissance moyenne annuelle des prénoms (en %). Au top des prénoms en volume, on trouve **Adam** pour les garçons avec 72 naissances et **Emma** pour les filles avec 53 naissances. Au top des prénoms en croissance moyenne annuelle on trouve **Youssef** (+79%) pour les garçons et **Luna** (+106%) pour les filles.\n\n# Résultats\n\n![](plots/prenoms_m2.png){fig-align=\"center\"}\n\n# Code\n\n## Import\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(skimr)\nlibrary(summarytools)\nlibrary(patchwork)\nlibrary(ggwordcloud)\nlibrary(plotly)\n\ndate_caption <- \"5 janvier 2024\"\nsource(\"tools/themes.R\") # themes\n\nsource <- read_csv(\"posts/2025-01-22/data/antibes_prenoms_naissance_ty62ggz.csv\")\ndf <- source\n```\n:::\n\n\n\n## Inspect\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\nnames(df)\nglimpse(df)\nsummary(df)\nskim(df)\nsapply(df, unique)\ndfSummary(df)\n```\n:::\n\n\n\n## Clean\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# standardize cols names and variables in chr type\ndf <-\n  df %>% \n  rename_with(tolower) %>%\n  rename_with(~ str_squish(.)) %>%\n  rename_with(~ str_replace_all(., \" \", \"_\")) %>%\n  mutate(across(where(is.character), ~ str_squish(str_to_lower(.))))\n\n# remove unwanted cols\ndf <-\n  df %>% \n  select(annee, enfant_sexe, enfant_prenom, nombre_occurrences)\n\n# Title case variables \ndf <-\n  df %>%\n  mutate(across(c(enfant_sexe, enfant_prenom), str_to_title))\n\n# Filter \ndf <-\n  df %>%\n  filter(annee >= 2012)\n```\n:::\n\n\n\n## Analysis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Evolution of total births\ndf %>%\n    group_by(annee) %>%\n    summarize(naissances = sum(nombre_occurrences)) %>% plot(type = \"l\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Top 10\ndf_top10 <-\n  df %>%\n  group_by(enfant_sexe, enfant_prenom) %>%\n  summarise(n = sum(nombre_occurrences)) %>%\n  arrange(-n) %>%\n  slice_max(n, n = 10)\n\n# Top 10 Male and Female\n  df_top10_M <- df_top10 %>% filter(enfant_sexe == \"M\")\n  df_top10_F <- df_top10 %>% filter(enfant_sexe == \"F\")\n\n# YoY Growth\ndt_prep_yoy <-\n  df %>% \n    group_by(enfant_prenom) %>%\n    mutate(nombre_occurrences_previous = lag(nombre_occurrences, order_by = annee),\n           yoy_growth = (nombre_occurrences / nombre_occurrences_previous - 1)*100)\n\ndf_yoy <- \ndt_prep_yoy %>%\n  drop_na() %>%\n  group_by(enfant_sexe, enfant_prenom) %>% \n  summarise(tot_nombre_occurences = sum(nombre_occurrences), # number of births\n            mean_yoy_growth = mean(yoy_growth))      # mean growth rate\n\ndf_yoy_top10 <-\ndf_yoy %>%\n  arrange(-tot_nombre_occurences) %>%\n  slice_max(tot_nombre_occurences, n = 10) %>%\n  filter(enfant_sexe != \"I\") \n\ndf_yoy_top10_M <-\n  df_yoy %>%\n  filter(enfant_sexe == \"M\") %>%\n  arrange(-tot_nombre_occurences) %>%\n  slice_max(tot_nombre_occurences, n = 10) \n\ndf_yoy_top10_F <-\n  df_yoy %>%\n  filter(enfant_sexe == \"F\") %>%\n  arrange(-tot_nombre_occurences) %>%\n  slice_max(tot_nombre_occurences, n = 10) \n```\n:::\n\n\n\n## Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ranking of top 10 names per volume, with adoption rate (Mean YoY Growth)\n  \ndf_yoy_top10$enfant_sexe <- factor(df_yoy_top10$enfant_sexe, levels = c(\"M\", \"F\"))\n\nplot_ranking_top10 <-\ndf_yoy_top10 %>%\n ggplot(aes(x = reorder(enfant_prenom, tot_nombre_occurences), y = tot_nombre_occurences)) +\n      geom_bar(aes(fill = enfant_sexe), stat = \"identity\", alpha = 0.7) +\n      geom_point(aes(x =  enfant_prenom, y = mean_yoy_growth), size = 2) +     \n      geom_segment(aes(\n             x = enfant_prenom, \n             xend = enfant_prenom, \n             y = 0, \n             yend = mean_yoy_growth), \n         color = darkblue, \n         alpha = 0.8,\n         size = 0.5) +\n      geom_text(aes(\n                      x =  enfant_prenom,             \n                      y = mean_yoy_growth,\n                      label = paste0(\"+\", round(mean_yoy_growth, 0), \"%\")\n                    ),\n                size = 5,\n                hjust = -0.15,\n                alpha = 0.8,\n                family = setfont\n                ) +\n  scale_fill_manual(values = c(\"#1D6FA1\", \"#824B79\")) +\n  facet_wrap(~enfant_sexe,  scales = \"free_y\") +\n  scale_y_continuous(limits = c(0,140), breaks = c(0, 25, 50, 75, 100)) +\n  coord_flip() + tt7\n```\n:::\n\n\n\n## Render\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ranking_top10 + \nlabs(caption = social_caption2)  + \nplot_annotation(\n  title = 'Prénoms à Antibes sur les 10 dernières années',\n  subtitle = \"Nombre de naissance (barres), et vitesse d'adoption en % (lignes) <br>Période 2013-2023\",\n  theme = theme(\n    plot.title = element_text(margin = margin(t = 13, b = 3), \n                              hjust = 0,\n                              family = setfont,\n                              face = \"bold\", \n                              color =\"black\",\n                              size = 18),\n    plot.subtitle = element_textbox_simple(\n      margin = margin(b = 20),\n      hjust = 0,\n      family = setfont,\n      size = 14,\n      colour =\"gray25\"),\n    plot.background = element_rect(fill = \"#FAE5C6\")\n  )\n) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=864}\n:::\n:::\n\n\n\n# Source\n\n[Prénoms des nouveaux-nés à Antibes, disponible sur data.gouv.fr](https://www.data.gouv.fr/fr/datasets/prenoms-des-nouveaux-nes-a-antibes/), mise à jour du 5 janvier 2024\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}